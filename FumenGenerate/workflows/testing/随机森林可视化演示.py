#!/usr/bin/env python3
"""
éšæœºæ£®æ—å†³ç­–è¿‡ç¨‹å¯è§†åŒ–æ¼”ç¤º
"""

import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.tree import DecisionTreeClassifier

def æ¼”ç¤ºå•æ£µå†³ç­–æ ‘çš„å­¦ä¹ è¿‡ç¨‹():
    """è¯¦ç»†å±•ç¤ºä¸€æ£µå†³ç­–æ ‘æ˜¯å¦‚ä½•å­¦ä¹ çš„"""
    print("ğŸŒ³ å•æ£µå†³ç­–æ ‘çš„å­¦ä¹ è¿‡ç¨‹æ¼”ç¤º")
    print("=" * 40)
    
    # è®­ç»ƒæ•°æ®
    è®­ç»ƒç‰¹å¾ = np.array([
        [0.8, 2500],  # [RMSèƒ½é‡, é¢‘è°±è´¨å¿ƒ] â†’ æœ‰éŸ³ç¬¦
        [0.2, 1800],  # [RMSèƒ½é‡, é¢‘è°±è´¨å¿ƒ] â†’ æ— éŸ³ç¬¦
        [0.9, 3200],  # [RMSèƒ½é‡, é¢‘è°±è´¨å¿ƒ] â†’ æœ‰éŸ³ç¬¦
        [0.1, 1000],  # [RMSèƒ½é‡, é¢‘è°±è´¨å¿ƒ] â†’ æ— éŸ³ç¬¦
        [0.6, 2200]   # [RMSèƒ½é‡, é¢‘è°±è´¨å¿ƒ] â†’ æœ‰éŸ³ç¬¦
    ])
    è®­ç»ƒæ ‡ç­¾ = np.array([1, 0, 1, 0, 1])
    ç‰¹å¾å = ['RMSèƒ½é‡', 'é¢‘è°±è´¨å¿ƒ']
    
    print("ğŸ“š è®­ç»ƒæ•°æ®:")
    for i, (ç‰¹å¾, æ ‡ç­¾) in enumerate(zip(è®­ç»ƒç‰¹å¾, è®­ç»ƒæ ‡ç­¾)):
        ç»“æœ = "æœ‰éŸ³ç¬¦" if æ ‡ç­¾ == 1 else "æ— éŸ³ç¬¦"
        print(f"   æ ·æœ¬{i+1}: RMS={ç‰¹å¾[0]:.1f}, é¢‘è°±è´¨å¿ƒ={ç‰¹å¾[1]:.0f} â†’ {ç»“æœ}")
    
    # åˆ›å»ºå•æ£µå†³ç­–æ ‘
    å†³ç­–æ ‘ = DecisionTreeClassifier(max_depth=2, random_state=42)
    å†³ç­–æ ‘.fit(è®­ç»ƒç‰¹å¾, è®­ç»ƒæ ‡ç­¾)
    
    print(f"\nğŸŒ³ å†³ç­–æ ‘çš„å­¦ä¹ ç»“æœ:")
    
    # æ¨¡æ‹Ÿå†³ç­–æ ‘çš„å†³ç­–è¿‡ç¨‹
    def æ¨¡æ‹Ÿå†³ç­–è¿‡ç¨‹(æ ·æœ¬ç‰¹å¾):
        RMS = æ ·æœ¬ç‰¹å¾[0]
        é¢‘è°±è´¨å¿ƒ = æ ·æœ¬ç‰¹å¾[1]
        
        print(f"   ğŸ“¥ è¾“å…¥: RMS={RMS:.1f}, é¢‘è°±è´¨å¿ƒ={é¢‘è°±è´¨å¿ƒ:.0f}")
        
        # æ ¹æ®å®é™…å†³ç­–æ ‘çš„åˆ†å‰²é€»è¾‘
        if RMS <= 0.5:  # ç¬¬ä¸€å±‚åˆ†å‰²
            print(f"   ğŸ¤” ç¬¬1å±‚åˆ¤æ–­: RMS={RMS:.1f} <= 0.5? æ˜¯çš„")
            print(f"   ğŸ¯ å†³ç­–: æ— éŸ³ç¬¦ (å› ä¸ºèƒ½é‡å¤ªä½)")
            return 0
        else:
            print(f"   ğŸ¤” ç¬¬1å±‚åˆ¤æ–­: RMS={RMS:.1f} > 0.5? æ˜¯çš„")
            if é¢‘è°±è´¨å¿ƒ <= 2400:  # ç¬¬äºŒå±‚åˆ†å‰²
                print(f"   ğŸ¤” ç¬¬2å±‚åˆ¤æ–­: é¢‘è°±è´¨å¿ƒ={é¢‘è°±è´¨å¿ƒ:.0f} <= 2400? æ˜¯çš„")
                print(f"   ğŸ¯ å†³ç­–: æœ‰éŸ³ç¬¦ (ä¸­ç­‰é¢‘ç‡)")
                return 1
            else:
                print(f"   ğŸ¤” ç¬¬2å±‚åˆ¤æ–­: é¢‘è°±è´¨å¿ƒ={é¢‘è°±è´¨å¿ƒ:.0f} > 2400? æ˜¯çš„")
                print(f"   ğŸ¯ å†³ç­–: æœ‰éŸ³ç¬¦ (é«˜é¢‘ç‡)")
                return 1
    
    # æµ‹è¯•æ–°æ ·æœ¬
    æ–°æ ·æœ¬ = np.array([0.7, 2800])
    print(f"\nğŸ§ª æµ‹è¯•æ–°æ ·æœ¬:")
    é¢„æµ‹ç»“æœ = æ¨¡æ‹Ÿå†³ç­–è¿‡ç¨‹(æ–°æ ·æœ¬)
    
    # éªŒè¯å®é™…ç»“æœ
    å®é™…é¢„æµ‹ = å†³ç­–æ ‘.predict([æ–°æ ·æœ¬])[0]
    print(f"   âœ… å®é™…APIç»“æœ: {å®é™…é¢„æµ‹}")
    
    return å†³ç­–æ ‘

def æ¼”ç¤ºéšæœºæ£®æ—çš„é›†ä½“å†³ç­–():
    """å±•ç¤º3æ£µæ ‘çš„é›†ä½“å†³ç­–è¿‡ç¨‹"""
    print(f"\nğŸŒ² éšæœºæ£®æ—çš„é›†ä½“å†³ç­–æ¼”ç¤º")
    print("=" * 35)
    
    # ä½¿ç”¨ç›¸åŒçš„è®­ç»ƒæ•°æ®
    è®­ç»ƒç‰¹å¾ = np.array([
        [0.8, 2500], [0.2, 1800], [0.9, 3200], 
        [0.1, 1000], [0.6, 2200]
    ])
    è®­ç»ƒæ ‡ç­¾ = np.array([1, 0, 1, 0, 1])
    
    # åˆ›å»ºéšæœºæ£®æ—
    éšæœºæ£®æ— = RandomForestClassifier(n_estimators=3, max_depth=2, random_state=42)
    éšæœºæ£®æ—.fit(è®­ç»ƒç‰¹å¾, è®­ç»ƒæ ‡ç­¾)
    
    # æµ‹è¯•æ ·æœ¬
    æµ‹è¯•æ ·æœ¬ = np.array([[0.7, 2800]])
    
    print(f"ğŸ“¥ æµ‹è¯•æ ·æœ¬: RMS=0.7, é¢‘è°±è´¨å¿ƒ=2800")
    print(f"\nğŸ‘¥ è¯¢é—®æ¯æ£µæ ‘çš„æ„è§:")
    
    # è·å–æ¯æ£µæ ‘çš„é¢„æµ‹
    ä¸ªåˆ«é¢„æµ‹ = []
    for i, å•æ£µæ ‘ in enumerate(éšæœºæ£®æ—.estimators_):
        é¢„æµ‹ = å•æ£µæ ‘.predict(æµ‹è¯•æ ·æœ¬)[0]
        æ¦‚ç‡ = å•æ£µæ ‘.predict_proba(æµ‹è¯•æ ·æœ¬)[0]
        ä¸ªåˆ«é¢„æµ‹.append(é¢„æµ‹)
        
        ç»“æœæ–‡å­— = "æœ‰éŸ³ç¬¦" if é¢„æµ‹ == 1 else "æ— éŸ³ç¬¦"
        print(f"   ğŸŒ³ å†³ç­–æ ‘{i+1}: {ç»“æœæ–‡å­—} (æ¦‚ç‡: æ— éŸ³ç¬¦{æ¦‚ç‡[0]:.2f}, æœ‰éŸ³ç¬¦{æ¦‚ç‡[1]:.2f})")
    
    # ç»Ÿè®¡æŠ•ç¥¨
    æœ‰éŸ³ç¬¦ç¥¨æ•° = sum(ä¸ªåˆ«é¢„æµ‹)
    æ€»ç¥¨æ•° = len(ä¸ªåˆ«é¢„æµ‹)
    
    print(f"\nğŸ—³ï¸  æŠ•ç¥¨ç»Ÿè®¡:")
    print(f"   æœ‰éŸ³ç¬¦: {æœ‰éŸ³ç¬¦ç¥¨æ•°}ç¥¨")
    print(f"   æ— éŸ³ç¬¦: {æ€»ç¥¨æ•° - æœ‰éŸ³ç¬¦ç¥¨æ•°}ç¥¨")
    print(f"   æ€»è®¡: {æ€»ç¥¨æ•°}ç¥¨")
    
    # æœ€ç»ˆå†³ç­–
    æ£®æ—æ¦‚ç‡ = æœ‰éŸ³ç¬¦ç¥¨æ•° / æ€»ç¥¨æ•°
    æœ€ç»ˆå†³ç­– = "æœ‰éŸ³ç¬¦" if æ£®æ—æ¦‚ç‡ > 0.5 else "æ— éŸ³ç¬¦"
    
    print(f"\nğŸ¯ éšæœºæ£®æ—æœ€ç»ˆå†³ç­–:")
    print(f"   æ¦‚ç‡: {æ£®æ—æ¦‚ç‡:.3f}")
    print(f"   å†³ç­–: {æœ€ç»ˆå†³ç­–}")
    
    # éªŒè¯APIç»“æœ
    apiæ¦‚ç‡ = éšæœºæ£®æ—.predict_proba(æµ‹è¯•æ ·æœ¬)[0][1]
    apié¢„æµ‹ = éšæœºæ£®æ—.predict(æµ‹è¯•æ ·æœ¬)[0]
    apiç»“æœ = "æœ‰éŸ³ç¬¦" if apié¢„æµ‹ == 1 else "æ— éŸ³ç¬¦"
    
    print(f"\nâœ… APIéªŒè¯:")
    print(f"   predict_proba: {apiæ¦‚ç‡:.3f}")
    print(f"   predict: {apiç»“æœ}")

def æ¼”ç¤ºéšæœºæ€§çš„ä½œç”¨():
    """å±•ç¤ºéšæœºæ€§å¦‚ä½•äº§ç”Ÿä¸åŒçš„æ ‘"""
    print(f"\nğŸ² éšæœºæ€§çš„ä½œç”¨æ¼”ç¤º")
    print("=" * 25)
    
    è®­ç»ƒç‰¹å¾ = np.array([
        [0.8, 2500], [0.2, 1800], [0.9, 3200], 
        [0.1, 1000], [0.6, 2200], [0.7, 2000],
        [0.3, 1500], [0.5, 2800]
    ])
    è®­ç»ƒæ ‡ç­¾ = np.array([1, 0, 1, 0, 1, 1, 0, 1])
    
    print("ğŸ¯ æ¼”ç¤ºBootstrapé‡‡æ ·çš„æ•ˆæœ:")
    
    # æ¨¡æ‹Ÿ3æ¬¡Bootstrapé‡‡æ ·
    np.random.seed(42)
    for i in range(3):
        # Bootstrapé‡‡æ ·ï¼šæœ‰æ”¾å›åœ°æŠ½å–æ ·æœ¬
        æ ·æœ¬ç´¢å¼• = np.random.choice(len(è®­ç»ƒç‰¹å¾), size=len(è®­ç»ƒç‰¹å¾), replace=True)
        bootstrapæ ·æœ¬ = è®­ç»ƒç‰¹å¾[æ ·æœ¬ç´¢å¼•]
        bootstrapæ ‡ç­¾ = è®­ç»ƒæ ‡ç­¾[æ ·æœ¬ç´¢å¼•]
        
        print(f"\n   ğŸŒ³ å†³ç­–æ ‘{i+1}çš„è®­ç»ƒæ•°æ® (Bootstrapé‡‡æ ·):")
        print(f"   æŠ½å–çš„æ ·æœ¬ç´¢å¼•: {æ ·æœ¬ç´¢å¼•}")
        
        # ç»Ÿè®¡æ¯ä¸ªåŸå§‹æ ·æœ¬è¢«é€‰ä¸­çš„æ¬¡æ•°
        é€‰ä¸­æ¬¡æ•° = {}
        for idx in æ ·æœ¬ç´¢å¼•:
            é€‰ä¸­æ¬¡æ•°[idx] = é€‰ä¸­æ¬¡æ•°.get(idx, 0) + 1
        
        print(f"   æ ·æœ¬åˆ†å¸ƒ: ", end="")
        for idx in range(len(è®­ç»ƒç‰¹å¾)):
            æ¬¡æ•° = é€‰ä¸­æ¬¡æ•°.get(idx, 0)
            print(f"æ ·æœ¬{idx}Ã—{æ¬¡æ•°} ", end="")
        print()
        
        # è®­ç»ƒè¿™æ£µæ ‘
        å•æ£µæ ‘ = DecisionTreeClassifier(max_depth=2, random_state=i)
        å•æ£µæ ‘.fit(bootstrapæ ·æœ¬, bootstrapæ ‡ç­¾)
        
        # æµ‹è¯•é¢„æµ‹å·®å¼‚
        æµ‹è¯•æ ·æœ¬ = np.array([[0.7, 2800]])
        é¢„æµ‹ = å•æ£µæ ‘.predict(æµ‹è¯•æ ·æœ¬)[0]
        ç»“æœ = "æœ‰éŸ³ç¬¦" if é¢„æµ‹ == 1 else "æ— éŸ³ç¬¦"
        print(f"   å¯¹æµ‹è¯•æ ·æœ¬çš„é¢„æµ‹: {ç»“æœ}")

def æ¯”è¾ƒå•æ ‘vséšæœºæ£®æ—():
    """æ¯”è¾ƒå•æ£µæ ‘å’Œéšæœºæ£®æ—çš„ç¨³å®šæ€§"""
    print(f"\nâš–ï¸  å•æ£µæ ‘ vs éšæœºæ£®æ—ç¨³å®šæ€§å¯¹æ¯”")
    print("=" * 35)
    
    # åŸå§‹è®­ç»ƒæ•°æ®
    åŸå§‹ç‰¹å¾ = np.array([
        [0.8, 2500], [0.2, 1800], [0.9, 3200], 
        [0.1, 1000], [0.6, 2200]
    ])
    åŸå§‹æ ‡ç­¾ = np.array([1, 0, 1, 0, 1])
    
    # è½»å¾®ä¿®æ”¹çš„æ•°æ®ï¼ˆæ¨¡æ‹Ÿå™ªå£°ï¼‰
    ä¿®æ”¹ç‰¹å¾ = åŸå§‹ç‰¹å¾.copy()
    ä¿®æ”¹ç‰¹å¾[0, 0] = 0.75  # æŠŠ0.8æ”¹æˆ0.75
    ä¿®æ”¹æ ‡ç­¾ = åŸå§‹æ ‡ç­¾.copy()
    
    æµ‹è¯•æ ·æœ¬ = np.array([[0.65, 2300]])
    
    print("ğŸ§ª æµ‹è¯•æ•°æ®ç¨³å®šæ€§:")
    print(f"   æµ‹è¯•æ ·æœ¬: RMS=0.65, é¢‘è°±è´¨å¿ƒ=2300")
    
    # å•æ£µå†³ç­–æ ‘çš„è¡¨ç°
    print(f"\nğŸŒ³ å•æ£µå†³ç­–æ ‘:")
    æ ‘1 = DecisionTreeClassifier(max_depth=2, random_state=42)
    æ ‘1.fit(åŸå§‹ç‰¹å¾, åŸå§‹æ ‡ç­¾)
    é¢„æµ‹1 = æ ‘1.predict(æµ‹è¯•æ ·æœ¬)[0]
    
    æ ‘2 = DecisionTreeClassifier(max_depth=2, random_state=42)
    æ ‘2.fit(ä¿®æ”¹ç‰¹å¾, ä¿®æ”¹æ ‡ç­¾)
    é¢„æµ‹2 = æ ‘2.predict(æµ‹è¯•æ ·æœ¬)[0]
    
    ç»“æœ1 = "æœ‰éŸ³ç¬¦" if é¢„æµ‹1 == 1 else "æ— éŸ³ç¬¦"
    ç»“æœ2 = "æœ‰éŸ³ç¬¦" if é¢„æµ‹2 == 1 else "æ— éŸ³ç¬¦"
    
    print(f"   åŸå§‹æ•°æ®è®­ç»ƒ: {ç»“æœ1}")
    print(f"   ä¿®æ”¹æ•°æ®è®­ç»ƒ: {ç»“æœ2}")
    print(f"   ç»“æœä¸€è‡´æ€§: {'âœ… ä¸€è‡´' if é¢„æµ‹1 == é¢„æµ‹2 else 'âŒ ä¸ä¸€è‡´'}")
    
    # éšæœºæ£®æ—çš„è¡¨ç°
    print(f"\nğŸŒ² éšæœºæ£®æ—:")
    æ£®æ—1 = RandomForestClassifier(n_estimators=10, max_depth=2, random_state=42)
    æ£®æ—1.fit(åŸå§‹ç‰¹å¾, åŸå§‹æ ‡ç­¾)
    æ¦‚ç‡1 = æ£®æ—1.predict_proba(æµ‹è¯•æ ·æœ¬)[0][1]
    
    æ£®æ—2 = RandomForestClassifier(n_estimators=10, max_depth=2, random_state=42)
    æ£®æ—2.fit(ä¿®æ”¹ç‰¹å¾, ä¿®æ”¹æ ‡ç­¾)
    æ¦‚ç‡2 = æ£®æ—2.predict_proba(æµ‹è¯•æ ·æœ¬)[0][1]
    
    print(f"   åŸå§‹æ•°æ®è®­ç»ƒ: {æ¦‚ç‡1:.3f}æ¦‚ç‡æœ‰éŸ³ç¬¦")
    print(f"   ä¿®æ”¹æ•°æ®è®­ç»ƒ: {æ¦‚ç‡2:.3f}æ¦‚ç‡æœ‰éŸ³ç¬¦")
    print(f"   æ¦‚ç‡å·®å¼‚: {abs(æ¦‚ç‡1 - æ¦‚ç‡2):.3f}")
    print(f"   ç¨³å®šæ€§: {'âœ… æ›´ç¨³å®š' if abs(æ¦‚ç‡1 - æ¦‚ç‡2) < 0.1 else 'âš ï¸  æœ‰æ³¢åŠ¨'}")

if __name__ == "__main__":
    # è¿è¡Œæ‰€æœ‰æ¼”ç¤º
    æ¼”ç¤ºå•æ£µå†³ç­–æ ‘çš„å­¦ä¹ è¿‡ç¨‹()
    æ¼”ç¤ºéšæœºæ£®æ—çš„é›†ä½“å†³ç­–()
    æ¼”ç¤ºéšæœºæ€§çš„ä½œç”¨()
    æ¯”è¾ƒå•æ ‘vséšæœºæ£®æ—()
    
    print(f"\nğŸ‰ æ€»ç»“:")
    print(f"   éšæœºæ£®æ— = å¤šä¸ªä¸åŒçš„å†³ç­–æ ‘ + æ°‘ä¸»æŠ•ç¥¨")
    print(f"   æ¯æ£µæ ‘éƒ½æœ‰è‡ªå·±çš„'ç»éªŒ'ï¼Œä½†é›†ä½“æ™ºæ…§æ›´å¯é ï¼")
